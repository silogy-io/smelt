---
slug: /defining-new-targets
---

# Creating new targets

End users can define their own smelt targets in their own repo by defining classes that inherit from the [Target][Target] class in the `${SMELT_ROOT}/smelt_rules` directory.

The only "required" method that is implemented from the [target][Target] is `gen_script` -- this is the function that generates the bash script for the default command.

An example of this can be seen in [yves][yves]:

```python


@dataclass
class local_benchmark(Target):
    profiler_path: str
    benchmark_path: str
    metadata: Optional[Dict[str, Any]] = None

    def get_dependent_files(self) -> List[str]:
        return [self.profiler_path, self.benchmark_path]

    @staticmethod
    def rule_type() -> SmeltTargetType:
        return SmeltTargetType.Test

    def gen_script(self) -> List[str]:
        metadata = self.metadata if self.metadata else {}
        metadata_content = f"'{json.dumps(metadata)}'"
        osname = platform.system()
        if osname == "Darwin":
            rv = f"DYLD_INSERT_LIBRARIES={self.profiler_path} {self.benchmark_path}"
        elif osname == "Linux":
            rv = f"LD_PRELOAD={self.profiler_path} {self.benchmark_path}"
        else:
            raise RuntimeError(f"Unsupported os {osname}")

        return [f"echo {metadata_content} &> {self.metadata_out()}", f"{rv}"]

    def metadata_out(self) -> str:
        return self.ws_path + "/metadata.json"

    def get_outputs(self) -> Dict[str, str]:
        ctr_file = self.ws_path + "/counters.json"

        return dict(counters=ctr_file, metadata=self.metadata_out())

    def runtime_requirements(self) -> RuntimeRequirements:
        rr = RuntimeRequirements.default()
        # Force the cpu requirement to be very high so only one benchmark runs
        # at a time
        rr.num_cpus = 1024
        return rr

```

{/* prettier-ignore-start */}
[Command]:https://github.com/silogy-io/smelt/blob/dev/py-smelt/pysmelt/interfaces/command.py
[Target]: https://github.com/silogy-io/smelt/blob/dev/py-smelt/pysmelt/interfaces/target.py
[smelt_root]: google.com
[bazel]: https://bazel.build
[buck2]: https://buck2.build
[yves]: https://github.com/silogy-io/yves

{/* prettier-ignore-end */}

```

```
